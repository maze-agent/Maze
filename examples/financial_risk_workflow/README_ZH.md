# 金融风险评估工作流 - LanggraphClient

## 🎯 整体业务场景

这是一个**投资组合风险管理系统**，模拟了银行或资产管理公司的风险评估流程。

**实际业务流程：**
假设你是一家资产管理公司的风险管理经理，客户委托你管理1亿元投资组合（60%股票 + 30%债券 + 10%现金）。在投资前，你需要评估这个组合可能面临的各种风险，给客户提供一份专业的风险评估报告。

## 📊 工作流执行流程

```
1. 投资组合描述输入
   ↓
2. [LLM智能分析] 提取关键参数
   ↓
3. 并行执行三个风险评估 (同时进行，节省时间)
   ├─ [市场风险] 计算可能的市场损失
   ├─ [信用风险] 评估违约风险
   └─ [流动性风险] 测试变现能力
   ↓
4. [汇总报告] 生成综合风险评估
```

## 🔍 每个函数的详细作用

### 1. llm_analysis_node - LLM 智能分析节点

**业务作用：** 使用LLM理解自然语言描述，提取关键参数。就像一个经验丰富的金融分析师，阅读投资组合的文字描述，自动提取关键数据。


**为什么需要LLM：** 
在实际业务中，客户或业务部门提供的是文字描述，不是结构化数据。LLM可以自动理解并提取，省去人工录入的工作。

---

### 2. market_risk_var_tool - 市场风险评估工具

**业务作用：** 回答"如果市场下跌，最坏情况下我会损失多少钱？"

**使用算法：** 蒙特卡洛模拟 + VaR (Value at Risk) 计算
 
 
---

### 3. credit_risk_monte_carlo_tool - 信用风险评估工具

**业务作用：** 回答"如果债券发行方违约，我会损失多少？"


**使用算法：** 蒙特卡洛模拟

---

### 4. liquidity_risk_stress_test_tool - 流动性风险评估工具

**业务作用：** 回答 " 如果突然需要变现，会损失多少？"。客户可能突然需要赎回资金（比如紧急用钱）。此时需要快速卖出资产，但市场可能没有足够买家，导致被迫降价出售。

**使用算法：** 蒙特卡洛模拟

---

### 5. generate_report_node - 综合报告生成节点

**业务作用：** 把三个维度的风险评估结果整合成一份完整报告

**具体做什么：**
- 收集前面三个工具的评估结果
- 按格式排版
- 输出一份专业的风险评估报告

**输出示例：**
```
====================================
投资组合综合风险评估报告
====================================

【风险维度 1】市场风险
- VaR值：2500万元
- 最大潜在损失占比：25%

【风险维度 2】信用风险
- 预期损失：120万元
- 95% CVaR：350万元

【风险维度 3】流动性风险
- 平均流动性损失：180万元
- 最大流动性损失：850万元
====================================
```


## 🎓 工作流总结

这个工作流模拟了一个**完整的投资组合风险管理流程**：

1. **自然语言理解** (LLM) → 提取参数
2. **并行风险计算** (3个工具) → 多维度评估  
3. **报告生成** → 给客户看的专业报告

在真实业务中，这样的系统可以：
- 自动处理客户的投资意向
- 快速评估各类风险
- 生成符合监管要求的报告
- 帮助投资经理做决策

## 💻 运行流程


### 1. 安装依赖

```bash
pip install -r requirements.txt
```

## 2. 配置API Key

设置通义千问 API Key：


```bash
export DASHSCOPE_API_KEY="your_api_key_here"
```

## 3. 运行工作流
### Naive langgraph
如果你要运行naive langgraph，直接执行
```python
python langgraph_naive.py
```

### Maze runtime as langgraph backend
maze 可以作为 langgraph 的运行时后端，大幅度提升langgraph e2e的性能
```bash
maze start --head --port HEAD_PORT # 启动Maze Head
python langgraph_maze.py
```
我们在Intel(R) Xeon(R) Gold 5117 CPU @ 2.00GHz规格的机器上进行测试，对于Naive langgraph耗时3min左右，使用Maze作为后端运行langgraph耗时47s左右，约 4倍 的e2e延迟优化。